(()=>{"use strict";const t=class{constructor(t){this.length=t,this.hitCount=0,this.sunk=!1}hit(){this.hitCount++,this.isSunk()}isSunk(){return this.length==this.hitCount&&(this.sunk=!0),this.sunk}},e=class{constructor(){this.board=this.buildGrid(),this.attacks=[],this.misses=[]}buildGrid(){let t=[];for(let e=0;e<10;e++){t.push([]);for(let s=0;s<10;s++)t[e].push(null)}return t}placeShip(e,s,o){const i=new t(o);let l=!1;const n=e[0],a=e[1];if(s){if(!(n+i.length<=this.board.length))return!1;for(let t=0;t<i.length;t++)if(this.board[n+t][a])return l=!0,!1;if(!l){for(let t=0;t<i.length;t++)this.getAdjacent(n+t,a),this.board[n+t][a]=i;return!0}}else{if(!(a+i.length<=this.board.length))return!1;for(let t=0;t<i.length;t++)if(this.board[n][a+t])return l=!0,!1;if(!l){for(let t=0;t<i.length;t++)this.getAdjacent(n,a+t),this.board[n][a+t]=i;return!0}}}validPos(t,e,s,o){return t<0||e<0||t>s-1||e>o-1?0:1}getAdjacent(e,s){let o=this.board.length,i=this.board[0].length;this.validPos(e-1,s-1,o,i)&&(this.board[e-1][s-1]=1),!this.validPos(e-1,s,o,i)||this.board[e-1][s]instanceof t||(this.board[e-1][s]=1),this.validPos(e-1,s+1,o,i)&&(this.board[e-1][s+1]=1),!this.validPos(e,s-1,o,i)||this.board[e][s-1]instanceof t||(this.board[e][s-1]=1),!this.validPos(e,s+1,o,i)||this.board[e][s+1]instanceof t||(this.board[e][s+1]=1),this.validPos(e+1,s-1,o,i)&&(this.board[e+1][s-1]=1),!this.validPos(e+1,s,o,i)||this.board[e+1][s]instanceof t||(this.board[e+1][s]=1),this.validPos(e+1,s+1,o,i)&&(this.board[e+1][s+1]=1)}recieveAttack(e){for(let t=0;t<this.attacks.length;t++)if(this.attacks[t][0]==e[0]&&this.attacks[t][1]==e[1])return"alreadyHit";return this.attacks.push(e),this.board[e[0]][e[1]]instanceof t?(this.board[e[0]][e[1]].hit(),this.allSunk()&&console.log("All ships sunk!"),!0):(this.misses.push(e),!1)}allSunk(){for(let e=0;e<this.board.length;e++)for(let s=0;s<this.board.length;s++)if(this.board[e][s]instanceof t&&!this.board[e][s].isSunk())return!1;return!0}},s=class{constructor(t){this.enemyBoard=t,this.attackedCoord}attack(t){return this.enemyBoard.recieveAttack(t)}randomAttack(){const t=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];return this.attackedCoord=t,this.enemyBoard.recieveAttack(t)}};!function(){const o=new e,i=new e;for(let t=5;t>0;t--){let e=!1;for(;!e;){const s=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];let o=Math.random()<.5;e=i.placeShip(s,o,t)}}const l=new s(o),n=new s(i),a=document.createElement("div");a.classList.add("board");const r=document.querySelector("body");r.appendChild(a);let d=5;const c=document.createElement("button");c.textContent="Rotate",c.id="rotateBtn",r.appendChild(c);let h=!1;c.onclick=function(){h=!1===h,console.log(h)};for(let e=0;e<10;e++)for(let s=0;s<10;s++){const l=document.createElement("div");l.classList.add("tile"),l.id=`${e},${s}`,l.onclick=function(){const e=this.id.split(",");if(o.placeShip([parseInt(e[0]),parseInt(e[1])],h,d)){d-=1;for(let e=0;e<10;e++)for(let s=0;s<10;s++)if(o.board[e][s]instanceof t){const t=document.getElementById(`${e},${s}`);t.classList.add("playerShip"),t.classList.add("ship")}}0==d&&(document.querySelectorAll(".tile").forEach((t=>{t.onclick=null,t.onmouseenter=null,t.onmouseleave=null})),r.removeChild(a),u(o),u(i))},l.onmouseenter=function(){const t=document.querySelectorAll(".tile");for(let e=0;e<t.length;e++)if(h){if(t[e].id==this.id&&parseInt(this.id[0])+d<=10)for(let s=e;s<10*d+e;s+=10)t[s].classList.add("placementTile")}else if(t[e].id==this.id&&parseInt(this.id[2])+d<=10)for(let s=e;s<d+e;s++)t[s].classList.add("placementTile")},l.onmouseleave=function(){document.querySelectorAll(".placementTile").forEach((t=>{t.classList.remove("placementTile")}))},a.appendChild(l)}function u(e){const s=document.createElement("div");0==document.getElementsByClassName("board").length?s.id="1":s.id="2",s.classList.add("board"),document.querySelector("body").appendChild(s);for(let a=0;a<e.board.length;a++)for(let r=0;r<e.board[a].length;r++){const d=document.createElement("div");d.classList.add("tile"),d.id=`${a},${r},${s.id}`,e.board[a][r]instanceof t&&(d.classList.add("ship"),"1"==s.id&&d.classList.add("playerShip")),"2"==s.id?(d.classList.add("computerTile"),d.onclick=function(){const t=n.attack([a,r]);if("alreadyHit"==t)return;this.style.backgroundColor=t?"red":"lightblue",d.style.cursor="default";const e=document.querySelectorAll(".playerTile");let s=l.randomAttack();for(;"alreadyHit"==s;)s=l.randomAttack();e.forEach((t=>{const e=t.id.split(",");[e[0],e[1]]==l.attackedCoord.toString()&&(s?(t.style.backgroundColor="red",s=!1):t.style.backgroundColor="lightblue")})),(o.allSunk()||i.allSunk())&&(console.log("Game Over"),document.querySelectorAll(".computerTile").forEach((t=>{t.onclick=null,t.classList.remove("computerTile")})))}):d.classList.add("playerTile"),s.appendChild(d)}}}()})();