(()=>{"use strict";const t=class{constructor(t){this.length=t,this.hitCount=0,this.sunk=!1}hit(){this.hitCount++,this.isSunk()}isSunk(){return this.length==this.hitCount&&(this.sunk=!0),this.sunk}},e=class{constructor(){this.board=this.buildGrid(),this.attacks=[],this.misses=[],this.justSunk=!1}buildGrid(){let t=[];for(let e=0;e<10;e++){t.push([]);for(let s=0;s<10;s++)t[e].push(null)}return t}placeShip(e,s,i){const o=new t(i);let l=!1;const n=e[0],a=e[1];if(s){if(!(n+o.length<=this.board.length))return!1;for(let t=0;t<o.length;t++)if(this.board[n+t][a])return l=!0,!1;if(!l){for(let t=0;t<o.length;t++)this.getAdjacent(n+t,a),this.board[n+t][a]=o;return!0}}else{if(!(a+o.length<=this.board.length))return!1;for(let t=0;t<o.length;t++)if(this.board[n][a+t])return l=!0,!1;if(!l){for(let t=0;t<o.length;t++)this.getAdjacent(n,a+t),this.board[n][a+t]=o;return!0}}}validPos(t,e,s,i){return t<0||e<0||t>s-1||e>i-1?0:1}getAdjacent(e,s){let i=10,o=10,l=[];return this.validPos(e,s-1,i,o)&&(l.push([e,s-1]),this.board[e][s-1]instanceof t||(this.board[e][s-1]=1),this.justSunk&&this.misses.push([e,s-1])),this.validPos(e-1,s-1,i,o)&&(this.board[e-1][s-1]=1,this.justSunk&&this.misses.push([e-1,s-1])),this.validPos(e-1,s,i,o)&&(l.push([e-1,s]),this.board[e-1][s]instanceof t||(this.board[e-1][s]=1),this.justSunk&&this.misses.push([e-1,s])),this.validPos(e-1,s+1,i,o)&&(this.board[e-1][s+1]=1,this.justSunk&&this.misses.push([e-1,s+1])),this.validPos(e,s+1,i,o)&&(l.push([e,s+1]),this.board[e][s+1]instanceof t||(this.board[e][s+1]=1),this.justSunk&&this.misses.push([e,s+1])),this.validPos(e+1,s+1,i,o)&&(this.board[e+1][s+1]=1,this.justSunk&&this.misses.push([e+1,s+1])),this.validPos(e+1,s,i,o)&&(l.push([e+1,s]),this.board[e+1][s]instanceof t||(this.board[e+1][s]=1),this.justSunk&&this.misses.push([e+1,s])),this.validPos(e+1,s-1,i,o)&&(this.board[e+1][s-1]=1,this.justSunk&&this.misses.push([e+1,s-1])),this.justSunk=!1,l}recieveAttack(e){for(let t=0;t<this.attacks.length;t++)if(this.attacks[t][0]==e[0]&&this.attacks[t][1]==e[1])return"alreadyHit";return this.attacks.push(e),this.board[e[0]][e[1]]instanceof t&&(this.board[e[0]][e[1]].hit(),!0)}allSunk(){for(let e=0;e<this.board.length;e++)for(let s=0;s<this.board.length;s++)if(this.board[e][s]instanceof t&&!this.board[e][s].isSunk())return!1;return!0}},s=class{constructor(t){this.enemyBoard=t,this.attackedCoord,this.possibleAttacks=this.attackList()}attackList(){let t=[];for(let e=0;e<10;e++)for(let s=0;s<10;s++)t.push([e,s]);for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}attack(t){return this.attackedCoord=t,this.enemyBoard.recieveAttack(t)}smartAttack(t,e){let s=this.enemyBoard.getAdjacent(t[0],t[1]),i=[];if("horizontal"==e){for(let e=0;e<s.length;e++)s[e][0]==t[0]&&i.push(s[e]);for(let t=0;t<i.length;t++)this.possibleAttacks.push(i[t]);return i.length}if("vertical"==e){for(let e=0;e<s.length;e++)s[e][1]==t[1]&&i.push(s[e]);for(let t=0;t<i.length;t++)this.possibleAttacks.push(i[t]);return i.length}for(let t=0;t<s.length;t++)this.possibleAttacks.push(s[t]);return s.length}};!function(){const i=new e,o=new e;for(let t=5;t>0;t--){let e=!1;for(;!e;){const s=[Math.floor(10*Math.random()),Math.floor(10*Math.random())];let i=Math.random()<.5;e=o.placeShip(s,i,t)}}const l=new s(i),n=new s(o),a=document.createElement("div");a.classList.add("board");const r=document.querySelector("body");r.appendChild(a);let h=5;const c=document.createElement("button");c.textContent="Rotate",c.id="rotateBtn",r.appendChild(c);let d=!1;c.onclick=function(){d=!1===d,console.log(d)};const u=document.querySelector("#instruction");u.textContent="Place your ships";for(let e=0;e<10;e++)for(let s=0;s<10;s++){const l=document.createElement("div");l.classList.add("tile"),l.id=`${e},${s}`,l.onclick=function(){const e=this.id.split(",");if(i.placeShip([parseInt(e[0]),parseInt(e[1])],d,h)){h-=1;for(let e=0;e<10;e++)for(let s=0;s<10;s++)if(i.board[e][s]instanceof t){const t=document.getElementById(`${e},${s}`);t.classList.add("playerShip"),t.classList.add("ship")}}0==h&&(document.querySelectorAll(".tile").forEach((t=>{t.onclick=null,t.onmouseenter=null,t.onmouseleave=null})),r.removeChild(a),r.removeChild(c),p(i),p(o),u.textContent="Shoot an enemy tile.")},l.onmouseenter=function(){const t=document.querySelectorAll(".tile");for(let e=0;e<t.length;e++)if(d){if(t[e].id==this.id&&parseInt(this.id[0])+h<=10)for(let s=e;s<10*h+e;s+=10)t[s].classList.add("placementTile")}else if(t[e].id==this.id&&parseInt(this.id[2])+h<=10)for(let s=e;s<h+e;s++)t[s].classList.add("placementTile")},l.onmouseleave=function(){document.querySelectorAll(".placementTile").forEach((t=>{t.classList.remove("placementTile")}))},a.appendChild(l)}function p(e){const s=document.createElement("div");0==document.getElementsByClassName("board").length?s.id="1":s.id="2",s.classList.add("board"),document.querySelector("body").appendChild(s);let a=null,r=[];for(let h=0;h<e.board.length;h++)for(let c=0;c<e.board[h].length;c++){const d=document.createElement("div");d.classList.add("tile"),d.id=`${h},${c},${s.id}`,d.textContent=`${h},${c}`,e.board[h][c]instanceof t&&(d.classList.add("ship"),"1"==s.id&&d.classList.add("playerShip")),"2"==s.id?(d.classList.add("computerTile"),d.onclick=function(){const t=n.attack([h,c]);if(d.style.cursor="default","alreadyHit"!=t){if(t)this.style.backgroundColor="red",u.textContent="You hit an enemy ship, shoot again!";else{u.textContent="Shoot an enemy tile.",this.style.backgroundColor="lightblue";const t=document.querySelectorAll(".playerTile");let e=!0,s=!1;for(;e;){let o=l.possibleAttacks.pop(),n=l.attack(o);for(;"alreadyHit"==n;)n=l.attack(l.possibleAttacks.pop());t.forEach((t=>{const o=t.id.split(","),h=[parseInt(o[0]),parseInt(o[1])];for(let e=0;e<i.misses.length;e++)h==i.misses[e]&&(console.log("yoo "+h+" "+i.misses[e]),t.style.backgroundColor="lightblue");if(h==l.attackedCoord.toString())if(n){t.style.backgroundColor="red";let e=i.board[o[0]][o[1]];console.log(e),r.push([h[0],h[1]]);let n=null;if(e.hitCount>1&&!e.sunk){if(console.log(h+", "+a),a[0]!=h[0]){n="vertical";let t=l.possibleAttacks.pop();t[1]==h[1]&&l.possibleAttacks.push(t)}if(a[1]!=h[1]){n="horizontal";let t=l.possibleAttacks.pop();t[0]==h[0]&&l.possibleAttacks.push(t)}}a=h,s=!0;let c=l.smartAttack(a,n);if(e.sunk){for(let t=0;t<c;t++)l.possibleAttacks.pop();for(let t=0;t<r.length;t++)console.log("Ship Array:"+r[t][0]),i.justSunk=!0,i.getAdjacent(r[t][0],r[t][1]);r=[]}}else t.style.backgroundColor="lightblue",e=!1}))}}(i.allSunk()||o.allSunk())&&(o.allSunk()?u.textContent="Congratulations, you sank all the enemy ships!":u.textContent="All your ships have sank, we need a better strategy.",document.querySelectorAll(".computerTile").forEach((t=>{t.onclick=null,t.classList.remove("computerTile")})))}}):d.classList.add("playerTile"),s.appendChild(d)}}}()})();